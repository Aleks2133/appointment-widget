<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Book Online</title>
  <style>
    .appointment-widget { max-width: 350px; margin: auto; font-family: sans-serif; }
    .appointment-widget input, .appointment-widget select, .appointment-widget button {
      width: 100%; margin: .5em 0; padding: .5em; box-sizing: border-box;
    }
  </style>
</head>
<body>
  <div class="appointment-widget">
    <form id="appointmentForm">
      <input name="firstName" placeholder="Imię" required>
      <input name="lastName" placeholder="Nazwisko" required>
      <input name="phone" placeholder="Telefon (SMS)" required>
      <input name="email" placeholder="E-mail (opcjonalnie)">
      <input name="appointment" type="datetime-local" required>
      <select name="service">
        <option value="Strzyżenie">Strzyżenie</option>
        <option value="Koloryzacja">Koloryzacja</option>
      </select>
      <button type="submit">Umów wizytę</button>
      <p id="status" style="color: green;"></p>
    </form>
  </div>
  <script>
    const form = document.getElementById('appointmentForm');
    const status = document.getElementById('status');
    const businessId = new URLSearchParams(location.search).get('businessId') || 'UNKNOWN';

    form.addEventListener('submit', async e => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form));
      data.businessId = businessId;
      try {
        const res = await fetch('https://twoj-n8n-host/api/webhook/appointment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        if (res.ok) {
          status.textContent = 'Dziękujemy! Twoja wizyta została zapisana.';
          form.reset();
        } else {
          status.style.color = 'red';
          status.textContent = 'Błąd — spróbuj ponownie.';
        }
      } catch {
        status.style.color = 'red';
        status.textContent = 'Błąd sieci — spróbuj później.';
      }
    });
  </script>
</body>
</html>
